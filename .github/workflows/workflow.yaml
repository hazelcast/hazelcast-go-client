
name: "Test Go Client v3"

on:
  push:
    branches: [ "master" ]
  pull_request:

jobs:

  test:
    runs-on: "ubuntu-latest"
    env:
      GOPATH: "${{ github.workspace }}"
      GO111MODULE: "off"
    defaults:
      run:
        shell: "bash"
        working-directory: "${{ env.GOPATH }}/src/github.com/hazelcast/hazelcast-go-client"
    steps:
      - name: "Checkout Code"
        uses: "actions/checkout@v2"
        with:
          path: "${{ env.GOPATH }}/src/github.com/hazelcast/hazelcast-go-client"

      - name: "Install Dependencies"
        run: |
          sudo apt-get update &&\
          sudo apt-get install -y openjdk-8-jdk-headless maven

      - name: "Download and Start Hazelcast Remote Controller"
        run: "bash ./start-rc.sh &"

      - name: "Set up Go"
        uses: "actions/setup-go@v2"
        with:
          go-version: "1.15"

      - name: "Test"
        run: |
            go get github.com/stretchr/testify/assert
            bash ./local-test.sh
